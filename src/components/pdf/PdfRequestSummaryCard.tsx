
import React from 'react';
import { Building2, LayoutGrid, Briefcase, Building, GitBranch, MapPin, Minimize2, Maximize2, MessageSquareText, Archive, UserCheck, DollarSign, Globe } from 'lucide-react';
import type { PropertyUsage, ResidentialPropertyType, CommercialPropertyType, RequestPurpose, CommercialCategory, ClientRole, RiyadhRegion } from "@/types";
import { RIYADH_REGIONS, riyadhRegionArabicMap } from "@/lib/constants"; // Import centralized map

const requestPurposesList: { value: RequestPurpose; labelAr: string; labelEn: string }[] = [ { value: "Buy", labelAr: "شراء", labelEn: "Buy" }, { value: "Rent", labelAr: "إيجار", labelEn: "Rent" }, { value: "Financing", labelAr: "تمويل", labelEn: "Financing" }, { value: "Partnership", labelAr: "شراكة", labelEn: "Partnership" }, { value: "Buy via Bank", labelAr: "شراء عن طريق بنك", labelEn: "Buy via Bank" }, ];
const clientRolesList: { value: ClientRole; labelAr: string; labelEn: string }[] = [ { value: "Applicant", labelAr: "صاحب الطلب", labelEn: "Applicant" }, { value: "Agent", labelAr: "وكيل", labelEn: "Agent" }, { value: "Broker", labelAr: "وسيط", labelEn: "Broker" }, { value: "CompanyEmployee", labelAr: "موظف شركة", labelEn: "Company Employee" }, { value: "Other", labelAr: "أخرى", labelEn: "Other" }, ];
const propertyUsagesList: { value: PropertyUsage; labelAr: string; labelEn: string }[] = [ { value: "Residential", labelAr: "سكني", labelEn: "Residential" }, { value: "Commercial", labelAr: "تجاري", labelEn: "Commercial" }, ];
const residentialPropertyTypesList: { value: ResidentialPropertyType; labelAr: string; labelEn: string }[] = [ { value: "Residential Land", labelAr: "أرض سكنية", labelEn: "Residential Land" }, { value: "Palace", labelAr: "قصر", labelEn: "Palace" }, { value: "Villa", labelAr: "فيلا", labelEn: "Villa" }, { value: "Duplex", labelAr: "دوبلكس", labelEn: "Duplex" }, { value: "Apartment", labelAr: "شقة", labelEn: "Apartment" }, { value: "Floor", labelAr: "دور", labelEn: "Floor" }, { value: "Building", labelAr: "عمارة", labelEn: "Building" }, { value: "Residential Complex", labelAr: "مجمع سكني", labelEn: "Residential Complex" }, { value: "Other", labelAr: "أخرى", labelEn: "Other" }, ];
const commercialPropertyTypesList: { value: CommercialPropertyType; labelAr: string; labelEn: string }[] = [ { value: "Commercial Land", labelAr: "أرض تجارية", labelEn: "Commercial Land" }, { value: "Showroom", labelAr: "معرض", labelEn: "Showroom" }, { value: "Office", labelAr: "مكتب", labelEn: "Office" }, { value: "Commercial Complex", labelAr: "مجمع تجاري", labelEn: "Commercial Complex" }, { value: "Commercial Building", labelAr: "عمارة تجارية", labelEn: "Commercial Building" }, { value: "Warehouse", labelAr: "مستودع", labelEn: "Warehouse" }, { value: "Workshop", labelAr: "ورشة", labelEn: "Workshop" }, { value: "Gas Station", labelAr: "محطة وقود", labelEn: "Gas Station" }, { value: "Other", labelAr: "أخرى", labelEn: "Other" }, ];
const commercialCategoriesListAll: { value: CommercialCategory; labelAr: string; labelEn: string }[] = [ { value: "Retail Trade", labelAr: "تجارة التجزئة", labelEn: "Retail Trade"}, { value: "Food & Beverages", labelAr: "الأغذية والمشروبات", labelEn: "Food & Beverages"}, { value: "Professional Services", labelAr: "الخدمات المهنية", labelEn: "Professional Services"}, { value: "Public Services", labelAr: "الخدمات العامة", labelEn: "Public Services"}, { value: "Education & Training", labelAr: "التعليم والتدريب", labelEn: "Education & Training"}, { value: "Entertainment & Tourism", labelAr: "الترفيه والسياحة", labelEn: "Entertainment & Tourism"}, { value: "Sports & Fitness", labelAr: "الرياضة واللياقة", labelEn: "Sports & Fitness"}, { value: "Logistics & Storage", labelAr: "اللوجستيات والتخزين", labelEn: "Logistics & Storage"}, { value: "Other", labelAr: "أخرى", labelEn: "Other"}, ];
const commercialActivitiesByCatAll: Record<string, { value: string; labelAr: string; labelEn: string }[]> = { "Retail Trade": [ {value: "Clothing & Fashion", labelAr: "ملابس وأزياء", labelEn: "Clothing & Fashion"}, {value: "Electronics", labelAr: "إلكترونيات", labelEn: "Electronics"}, {value: "Home Furniture", labelAr: "أثاث منزلي", labelEn: "Home Furniture"}, {value: "Supermarket", labelAr: "سوبر ماركت", labelEn: "Supermarket"}, {value: "Other Retail Trade", labelAr: "أخرى (تجارة التجزئة)", labelEn: "Other (Retail Trade)" } ], "Food & Beverages": [ {value: "Restaurant", labelAr: "مطعم", labelEn: "Restaurant"}, {value: "Cafe", labelAr: "مقهى", labelEn: "Cafe"}, {value: "Sweets", labelAr: "حلويات", labelEn: "Sweets"}, {value: "Bakery", labelAr: "مخبز", labelEn: "Bakery"}, {value: "Other Food & Beverages", labelAr: "أخرى (الأغذية والمشروبات)", labelEn: "Other (Food & Beverages)" } ], "Professional Services": [ {value: "Legal Consulting", labelAr: "استشارات قانونية", labelEn: "Legal Consulting"}, {value: "Financial Consulting", labelAr: "استشارات مالية", labelEn: "Financial Consulting"}, {value: "Accounting Services", labelAr: "خدمات محاسبية", labelEn: "Accounting Services"}, {value: "Engineering Services", labelAr: "خدمات هندسية", labelEn: "Engineering Services"}, {value: "Other Professional Services", labelAr: "أخرى (الخدمات المهنية)", labelEn: "Other (Professional Services)" } ], "Public Services": [ {value: "Medical Clinic", labelAr: "عيادة طبية", labelEn: "Medical Clinic"}, {value: "Pharmacy", labelAr: "صيدلية", labelEn: "Pharmacy"}, {value: "Medical Lab", labelAr: "مختبر طبي", labelEn: "Medical Lab"}, {value: "Beauty Center", labelAr: "مركز تجميل", labelEn: "Beauty Center"}, {value: "Other Public Services", labelAr: "أخرى (الخدمات العامة)", labelEn: "Other (Public Services)" } ], "Education & Training": [ {value: "Private School", labelAr: "مدرسة خاصة", labelEn: "Private School"}, {value: "Training Institute", labelAr: "معهد تدريب", labelEn: "Training Institute"}, {value: "Kindergarten", labelAr: "روضة أطفال", labelEn: "Kindergarten"}, {value: "Educational Center", labelAr: "مركز تعليمي", labelEn: "Educational Center"}, {value: "Other Education & Training", labelAr: "أخرى (التعليم والتدريب)", labelEn: "Other (Education & Training)" } ], "Entertainment & Tourism": [ {value: "Hotel", labelAr: "فندق", labelEn: "Hotel"}, {value: "Resort", labelAr: "منتجع", labelEn: "Resort"}, {value: "Entertainment Center", labelAr: "مركز ترفيهي", labelEn: "Entertainment Center"}, {value: "Wedding Hall", labelAr: "صالة أفراح", labelEn: "Wedding Hall"}, {value: "Other Entertainment & Tourism", labelAr: "أخرى (الترفيه والسياحة)", labelEn: "Other (Entertainment & Tourism)" } ], "Sports & Fitness": [ {value: "Sports Club", labelAr: "نادي رياضي", labelEn: "Sports Club"}, {value: "Gym", labelAr: "صالة ألعاب", labelEn: "Gym"}, {value: "Swimming Pool", labelAr: "مسبح", labelEn: "Swimming Pool"}, {value: "Playground", labelAr: "ملعب", labelEn: "Playground"}, {value: "Other Sports & Fitness", labelAr: "أخرى (الرياضة واللياقة)", labelEn: "Other (Sports & Fitness)" } ], "Logistics & Storage": [ {value: "Storage Warehouse", labelAr: "مستودع تخزين", labelEn: "Storage Warehouse"}, {value: "Distribution Center", labelAr: "مركز توزيع", labelEn: "Distribution Center"}, {value: "Shipping & Delivery", labelAr: "شحن وتوصيل", labelEn: "Shipping & Delivery"}, {value: "Logistics Services", labelAr: "خدمات لوجستية", labelEn: "Logistics Services"}, {value: "Other Logistics & Storage", labelAr: "أخرى (اللوجستيات والتخزين)", labelEn: "Other (Logistics & Storage)" } ], "Other": [ {value: "Other Activity", labelAr: "نشاط آخر (يرجى التحديد)", labelEn: "Other Activity (Please Specify)" } ]};

export interface PdfRequestSummaryCardProps {
  requestId: string; requestDate: string; clientRole?: ClientRole; otherClientRole?: string;
  requestPurpose?: RequestPurpose; usage?: PropertyUsage; propertyType?: string; otherPropertyType?: string;
  commercialCategory?: CommercialCategory; otherCommercialCategory?: string; commercialActivity?: string; otherCommercialActivity?: string;
  branchCount?: number; region?: RiyadhRegion; neighborhoodPreferences?: string[];
  minArea?: number; maxArea?: number; budgetMin?: number; budgetMax?: number;
  notes?: string; mapScreenshot?: string | null;
}

const PdfRequestSummaryCard: React.FC<PdfRequestSummaryCardProps> = ({
  requestId, requestDate, clientRole, otherClientRole, requestPurpose, usage, propertyType, otherPropertyType,
  commercialCategory, otherCommercialCategory, commercialActivity, otherCommercialActivity, branchCount, region,
  neighborhoodPreferences, minArea, maxArea, budgetMin, budgetMax, notes, mapScreenshot,
}) => {
  const InfoRow: React.FC<{ label: string; value?: string | number | string[] | null; icon?: React.ReactNode; keySuffix?: string; dirValue?: "ltr" | "rtl"; }> = ({ label, value, icon, keySuffix, dirValue = "rtl" }) => {
    if (value === undefined || value === null || (Array.isArray(value) && value.length === 0) || String(value).trim() === "") { return null; }
    const displayValue = Array.isArray(value) ? value.join('، ') : String(value);
    return (<div key={`${label}-${keySuffix || ''}`} className="py-2 px-3 flex justify-between items-start text-sm border-b border-gray-200" style={{ fontFamily: 'Almarai, "Trebuchet MS", sans-serif' }}><div className="flex items-center font-semibold text-gray-700">{icon && <span className="mr-2 ml-1 text-gray-500">{icon}</span>}{label}:</div><div className="text-right text-gray-600 break-words max-w-[60%]" style={{ fontFamily: 'Almarai, "Trebuchet MS", sans-serif' }} dir={dirValue}>{displayValue}</div></div>);};
  const getArabicLabel = (value: string | undefined, list: { value: string; labelAr: string; labelEn: string }[]) => { if (!value) return undefined; return list.find(item => item.value === value)?.labelAr || value; };
  const getArabicActivityLabel = (activityValue: string | undefined, categoryValue: CommercialCategory | undefined) => { if (!activityValue || !categoryValue) return activityValue; if (!Object.prototype.hasOwnProperty.call(commercialActivitiesByCatAll, categoryValue)) return activityValue; const activitiesForCategory = commercialActivitiesByCatAll[categoryValue]; if (!activitiesForCategory) return activityValue; return activitiesForCategory.find(item => item.value === activityValue)?.labelAr || activityValue; };
  let combinedNotes = "";
  const clientRoleAr = getArabicLabel(clientRole, clientRolesList); if (clientRoleAr === "أخرى" && otherClientRole) { combinedNotes += `صفة العميل: أخرى (${otherClientRole})\n`; } else if (clientRoleAr) { combinedNotes += `صفة العميل: ${clientRoleAr}\n`; }
  const requestPurposeAr = getArabicLabel(requestPurpose, requestPurposesList); if (requestPurposeAr) combinedNotes += `الغرض من الطلب: ${requestPurposeAr}\n`;
  const usageAr = getArabicLabel(usage, propertyUsagesList); if (usageAr) combinedNotes += `الاستخدام: ${usageAr}\n`;
  let propertyTypeDisplayAr = ""; if (usage === "Residential" && propertyType) { propertyTypeDisplayAr = getArabicLabel(propertyType, residentialPropertyTypesList) || propertyType; } else if (usage === "Commercial" && propertyType) { propertyTypeDisplayAr = getArabicLabel(propertyType, commercialPropertyTypesList) || propertyType; } else if (propertyType) { propertyTypeDisplayAr = propertyType; }
  if (propertyTypeDisplayAr === "أخرى" && otherPropertyType) { combinedNotes += `نوع العقار: أخرى (${otherPropertyType})\n`; } else if (propertyTypeDisplayAr) { combinedNotes += `نوع العقار: ${propertyTypeDisplayAr}\n`; }
  if (usage === 'Commercial') { const commercialCategoryAr = getArabicLabel(commercialCategory, commercialCategoriesListAll); if (commercialCategoryAr === "أخرى" && otherCommercialCategory) { combinedNotes += `فئة النشاط: أخرى (${otherCommercialCategory})\n`; } else if (commercialCategoryAr) { combinedNotes += `فئة النشاط: ${commercialCategoryAr}\n`; }
    const commercialActivityAr = getArabicActivityLabel(commercialActivity, commercialCategory); if ((commercialActivityAr?.startsWith("أخرى") || commercialActivity === "Other Activity") && otherCommercialActivity) { combinedNotes += `النشاط التجاري: ${commercialActivityAr?.replace(/\s*\(يرجى التحديد\)/, '')} (${otherCommercialActivity})\n`; } else if (commercialActivityAr) { combinedNotes += `النشاط التجاري: ${commercialActivityAr}\n`; }
    if (branchCount !== undefined && branchCount > 0) combinedNotes += `عدد الفروع: ${branchCount}\n`; }
  if (notes) { if (combinedNotes.trim()) combinedNotes += "\n--- ملاحظات إضافية ---\n"; combinedNotes += notes; }
  const regionDisplay = region ? riyadhRegionArabicMap[region] : undefined;

  return (
    <div className="p-6 bg-white border border-gray-300 rounded-lg shadow-lg" style={{ fontFamily: 'Almarai, "Trebuchet MS", sans-serif !important', direction: 'rtl', width: '100%' }}>
      <div className="text-center mb-6 pb-4 border-b border-gray-300" style={{ fontFamily: 'Almarai, "Trebuchet MS", sans-serif !important' }}><h1 className="text-3xl font-bold" style={{ color: '#4f5b93', fontFamily: 'Almarai, "Trebuchet MS", sans-serif !important' }}>AVAZ<span style={{color: '#b3a07f'}}>.</span></h1><p className="text-sm text-gray-500" style={{ fontFamily: 'Almarai, "Trebuchet MS", sans-serif !important' }}>طلب عقار - Property Request</p></div>
      <div className="grid grid-cols-2 gap-x-4 mb-4 text-xs" style={{ fontFamily: 'Almarai, "Trebuchet MS", sans-serif !important' }} dir="ltr"><InfoRow label="رقم الطلب" value={requestId} keySuffix="reqId" dirValue="ltr"/><InfoRow label="تاريخ الطلب" value={requestDate} keySuffix="reqDate" dirValue="ltr"/></div>
      <div className="mb-4" style={{ fontFamily: 'Almarai, "Trebuchet MS", sans-serif !important' }}><h2 className="text-lg font-bold text-gray-700 mb-2 p-2 bg-gray-100 rounded-md" style={{ fontFamily: 'Almarai, "Trebuchet MS", sans-serif !important' }}>الموقع والمتطلبات</h2>
        {regionDisplay && <InfoRow label="النطاق" value={regionDisplay} icon={<Globe size={16}/>} keySuffix="region" />}
        <InfoRow label="الأحياء المفضلة" value={neighborhoodPreferences && neighborhoodPreferences.length > 0 ? neighborhoodPreferences.join('، ') : undefined} icon={<MapPin size={16}/>} keySuffix="hoods" />
        <InfoRow label="أدنى مساحة (م²)" value={minArea ? minArea.toLocaleString('en-US') : undefined} icon={<Minimize2 size={16}/>} keySuffix="minArea" dirValue="ltr"/>
        <InfoRow label="أقصى مساحة (م²)" value={maxArea ? maxArea.toLocaleString('en-US') : undefined} icon={<Maximize2 size={16}/>} keySuffix="maxArea" dirValue="ltr"/>
        <InfoRow label="أدنى ميزانية (SAR)" value={budgetMin ? budgetMin.toLocaleString('en-US') : undefined} icon={<DollarSign size={16}/>} keySuffix="budgetMin" dirValue="ltr"/>
        <InfoRow label="أقصى ميزانية (SAR)" value={budgetMax ? budgetMax.toLocaleString('en-US') : undefined} icon={<DollarSign size={16}/>} keySuffix="budgetMax" dirValue="ltr"/></div>
      {(combinedNotes.trim()) && (<div className="mb-4" style={{ fontFamily: 'Almarai, "Trebuchet MS", sans-serif !important' }}><h2 className="text-lg font-bold text-gray-700 mb-2 p-2 bg-gray-100 rounded-md" style={{ fontFamily: 'Almarai, "Trebuchet MS", sans-serif !important' }}>تفاصيل العقار والملاحظات</h2><div className="p-3 text-sm text-gray-600 border rounded-md bg-gray-50 whitespace-pre-wrap" style={{ fontFamily: 'Almarai, "Trebuchet MS", sans-serif !important' }}><MessageSquareText size={16} className="inline-block mr-2 ml-1 align-middle text-gray-500" />{combinedNotes.trim()}</div></div>)}
      {mapScreenshot && (<div className="mt-4" style={{ fontFamily: 'Almarai, "Trebuchet MS", sans-serif !important' }}><h2 className="text-lg font-bold text-gray-700 mb-2 p-2 bg-gray-100 rounded-md" style={{ fontFamily: 'Almarai, "Trebuchet MS", sans-serif !important' }}>النطاق الجغرافي المحدد</h2><div className="border rounded-md overflow-hidden"><img src={mapScreenshot} alt="النطاق الجغرافي" style={{ width: '100%', height: 'auto', objectFit: 'contain', display: 'block' }} data-ai-hint="map location"/></div></div>)}
      <div className="mt-8 pt-4 border-t border-gray-300 text-center text-xs text-gray-400" style={{ fontFamily: 'Almarai, "Trebuchet MS", sans-serif !important' }}><p style={{ fontFamily: 'Almarai, "Trebuchet MS", sans-serif !important' }}>هذا المستند لغرض المشاركة الداخلية مع المتعاونين ولا يحتوي على معلومات العميل الشخصية.</p><p style={{ fontFamily: 'Almarai, "Trebuchet MS", sans-serif !important' }} dir="ltr">&copy; {new Date().getFullYear()} AVAZ Real Estate. All rights reserved.</p></div></div>);};
export default PdfRequestSummaryCard;

    
